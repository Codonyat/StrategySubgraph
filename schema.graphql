type LotteryPrize @entity(immutable: false) {
  id: ID! # day-lottery format: "123-lottery"
  day: BigInt!
  winner: Bytes!
  amount: BigInt!
  claimed: Boolean!
  claimTimestamp: BigInt
  claimTxHash: Bytes
  expired: Boolean!
  expiryTimestamp: BigInt
  expiryTxHash: Bytes
  beneficiary: Bytes
  timestamp: BigInt!
  blockNumber: BigInt!
  txHash: Bytes!
  user: User!
}

type AuctionPrize @entity(immutable: false) {
  id: ID! # day-auction format: "123-auction"
  day: BigInt!
  winner: Bytes!
  tokenAmount: BigInt!
  nativePaid: BigInt!
  claimed: Boolean!
  claimTimestamp: BigInt
  claimTxHash: Bytes
  expired: Boolean!
  expiryTimestamp: BigInt
  expiryTxHash: Bytes
  beneficiary: Bytes
  timestamp: BigInt!
  blockNumber: BigInt!
  txHash: Bytes!
  bidCount: Int
  user: User!
}

type Transaction @entity(immutable: false) {
  id: ID! # Sequential number format
  type: TransactionType!
  user: Bytes!
  collateralAmount: BigInt!
  tokenAmount: BigInt!
  fee: BigInt!
  timestamp: BigInt!
  blockNumber: BigInt!
  txHash: Bytes!
  userEntity: User!
}

enum TransactionType {
  MINT
  REDEEM
  TRANSFER
}

type User @entity(immutable: false) {
  id: ID! # user address
  address: Bytes!
  lotteryWins: [LotteryPrize!]! @derivedFrom(field: "user")
  auctionWins: [AuctionPrize!]! @derivedFrom(field: "user")
  transactions: [Transaction!]! @derivedFrom(field: "userEntity")
  totalLotteryWinnings: BigInt!
  totalAuctionWinnings: BigInt!
  totalAuctionSpent: BigInt!
  lotteryWinCount: Int!
  auctionWinCount: Int!
  totalMinted: BigInt!
  totalRedeemed: BigInt!
  transactionCount: Int!
}

type ProtocolStats @entity(immutable: false) {
  id: ID! # "protocol-stats"
  totalLotteryPrizes: BigInt!
  totalAuctionPrizes: BigInt!
  totalLotteryClaimed: BigInt!
  totalAuctionClaimed: BigInt!
  totalLotteryExpired: BigInt!
  totalAuctionExpired: BigInt!
  lotteryCount: Int!
  auctionCount: Int!
  totalMinted: BigInt!
  totalRedeemed: BigInt!
  totalFees: BigInt!
  totalTransactions: Int!
  transactionCounter: Int!
  lastLotteryDay: BigInt!
  lastAuctionDay: BigInt!
}

type Bid @entity(immutable: true) {
  id: ID! # txHash-logIndex format
  auction: AuctionPrize!
  bidder: Bytes!
  amount: BigInt!
  day: BigInt!
  timestamp: BigInt!
  blockNumber: BigInt!
  txHash: Bytes!
}
